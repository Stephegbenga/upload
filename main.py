from flask import Flask, request, abort
import hmac
import hashlib
import base64
app = Flask(__name__)
import json

t = {'id': 820982911946154508, 'email': 'jon@doe.ca', 'closed_at': None, 'created_at': '2022-03-14T10:14:59+01:00', 'updated_at': '2022-03-14T10:14:59+01:00', 'number': 234, 'note': None, 'token': '123456abcd', 'gateway': None, 'test': True, 'total_price': '28.90', 'subtotal_price': '18.90', 'total_weight': 0, 'total_tax': '0.00', 'taxes_included': False, 'currency': 'EUR', 'financial_status': 'voided', 'confirmed': False, 'total_discounts': '5.00', 'total_line_items_price': '23.90', 'cart_token': None, 'buyer_accepts_marketing': True, 'name': '#9999', 'referring_site': None, 'landing_site': None, 'cancelled_at': '2022-03-14T10:14:59+01:00', 'cancel_reason': 'customer', 'total_price_usd': None, 'checkout_token': None, 'reference': None, 'user_id': None, 'location_id': None, 'source_identifier': None, 'source_url': None, 'processed_at': None, 'device_id': None, 'phone': None, 'customer_locale': 'de', 'app_id': None, 'browser_ip': None, 'landing_site_ref': None, 'order_number': 1234, 'discount_applications': [{'type': 'manual', 'value': '5.0', 'value_type': 'fixed_amount', 'allocation_method': 'each', 'target_selection': 'explicit', 'target_type': 'line_item', 'description': 'Discount', 'title': 'Discount'}], 'discount_codes': [], 'note_attributes': [], 'payment_gateway_names': ['visa', 'bogus'], 'processing_method': '', 'checkout_id': None, 'source_name': 'web', 'fulfillment_status': 'pending', 'tax_lines': [], 'tags': '', 'contact_email': 'jon@doe.ca', 'order_status_url': 'https://www.baseshirt.de/49877778602/orders/123456abcd/authenticate?key=abcdefg', 'presentment_currency': 'EUR', 'total_line_items_price_set': {'shop_money': {'amount': '23.90', 'currency_code': 'EUR'}, 'presentment_money': {'amount': '23.90', 'currency_code': 'EUR'}}, 'total_discounts_set': {'shop_money': {'amount': '5.00', 'currency_code': 'EUR'}, 'presentment_money': {'amount': '5.00', 'currency_code': 'EUR'}}, 'total_shipping_price_set': {'shop_money': {'amount': '10.00', 'currency_code': 'EUR'}, 'presentment_money': {'amount': '10.00', 'currency_code': 'EUR'}}, 'subtotal_price_set': {'shop_money': {'amount': '18.90', 'currency_code': 'EUR'}, 'presentment_money': {'amount': '18.90', 'currency_code': 'EUR'}}, 'total_price_set': {'shop_money': {'amount': '28.90', 'currency_code': 'EUR'}, 'presentment_money': {'amount': '28.90', 'currency_code': 'EUR'}}, 'total_tax_set': {'shop_money': {'amount': '0.00', 'currency_code': 'EUR'}, 'presentment_money': {'amount': '0.00', 'currency_code': 'EUR'}}, 'line_items': [{'id': 866550311766439020, 'variant_id': 36959034310826, 'title': 'Camo Triumph T-Shirt Damen', 'quantity': 1, 'sku': 'C363212', 'variant_title': None, 'vendor': None, 'fulfillment_service': 'manual', 'product_id': 5916852715690, 'requires_shipping': True, 'taxable': True, 'gift_card': False, 'name': 'Camo Triumph T-Shirt Damen', 'variant_inventory_management': None, 'properties': [], 'product_exists': True, 'fulfillable_quantity': 1, 'grams': 0, 'price': '7.95', 'total_discount': '0.00', 'fulfillment_status': None, 'price_set': {'shop_money': {'amount': '7.95', 'currency_code': 'EUR'}, 'presentment_money': {'amount': '7.95', 'currency_code': 'EUR'}}, 'total_discount_set': {'shop_money': {'amount': '0.00', 'currency_code': 'EUR'}, 'presentment_money': {'amount': '0.00', 'currency_code': 'EUR'}}, 'discount_allocations': [], 'duties': [], 'admin_graphql_api_id': 'gid://shopify/LineItem/866550311766439020', 'tax_lines': []}, {'id': 141249953214522974, 'variant_id': 42609236508842, 'title': 'Comfort Hose Kinder', 'quantity': 1, 'sku': '6070107', 'variant_title': None, 'vendor': None, 'fulfillment_service': 'manual', 'product_id': 7269357519018, 'requires_shipping': True, 'taxable': True, 'gift_card': False, 'name': 'Comfort Hose Kinder', 'variant_inventory_management': None, 'properties': [], 'product_exists': True, 'fulfillable_quantity': 1, 'grams': 0, 'price': '15.95', 'total_discount': '5.00', 'fulfillment_status': None, 'price_set': {'shop_money': {'amount': '15.95', 'currency_code': 'EUR'}, 'presentment_money': {'amount': '15.95', 'currency_code': 'EUR'}}, 'total_discount_set': {'shop_money': {'amount': '5.00', 'currency_code': 'EUR'}, 'presentment_money': {'amount': '5.00', 'currency_code': 'EUR'}}, 'discount_allocations': [{'amount': '5.00', 'discount_application_index': 0, 'amount_set': {'shop_money': {'amount': '5.00', 'currency_code': 'EUR'}, 'presentment_money': {'amount': '5.00', 'currency_code': 'EUR'}}}], 'duties': [], 'admin_graphql_api_id': 'gid://shopify/LineItem/141249953214522974', 'tax_lines': []}], 'fulfillments': [], 'refunds': [], 'total_tip_received': '0.0', 'original_total_duties_set': None, 'current_total_duties_set': None, 'payment_terms': None, 'admin_graphql_api_id': 'gid://shopify/Order/820982911946154508', 'shipping_lines': [{'id': 271878346596884015, 'title': 'Generic Shipping', 'price': '10.00', 'code': None, 'source': 'shopify', 'phone': None, 'requested_fulfillment_service_id': None, 'delivery_category': None, 'carrier_identifier': None, 'discounted_price': '10.00', 'price_set': {'shop_money': {'amount': '10.00', 'currency_code': 'EUR'}, 'presentment_money': {'amount': '10.00', 'currency_code': 'EUR'}}, 'discounted_price_set': {'shop_money': {'amount': '10.00', 'currency_code': 'EUR'}, 'presentment_money': {'amount': '10.00', 'currency_code': 'EUR'}}, 'discount_allocations': [], 'tax_lines': []}], 'billing_address': {'first_name': 'Bob', 'address1': '123 Billing Street', 'phone': '555-555-BILL', 'city': 'Billtown', 'zip': 'K2P0B0', 'province': 'Kentucky', 'country': 'United States', 'last_name': 'Biller', 'address2': None, 'company': 'My Company', 'latitude': None, 'longitude': None, 'name': 'Bob Biller', 'country_code': 'US', 'province_code': 'KY'}, 'shipping_address': {'first_name': 'Steve', 'address1': '123 Shipping Street', 'phone': '555-555-SHIP', 'city': 'Shippington', 'zip': '40003', 'province': 'Kentucky', 'country': 'United States', 'last_name': 'Shipper', 'address2': None, 'company': 'Shipping Company', 'latitude': None, 'longitude': None, 'name': 'Steve Shipper', 'country_code': 'US', 'province_code': 'KY'}, 'customer': {'id': 115310627314723954, 'email': 'john@test.com', 'accepts_marketing': False, 'created_at': None, 'updated_at': None, 'first_name': 'John', 'last_name': 'Smith', 'orders_count': 0, 'state': 'disabled', 'total_spent': '0.00', 'last_order_id': None, 'note': None, 'verified_email': True, 'multipass_identifier': None, 'tax_exempt': False, 'phone': None, 'tags': '', 'last_order_name': None, 'currency': 'EUR', 'accepts_marketing_updated_at': None, 'marketing_opt_in_level': None, 'email_marketing_consent': {'state': 'not_subscribed', 'opt_in_level': None, 'consent_updated_at': None}, 'sms_marketing_consent': None, 'admin_graphql_api_id': 'gid://shopify/Customer/115310627314723954', 'default_address': {'id': 715243470612851245, 'customer_id': 115310627314723954, 'first_name': None, 'last_name': None, 'company': None, 'address1': '123 Elm St.', 'address2': None, 'city': 'Ottawa', 'province': 'Ontario', 'country': 'Canada', 'zip': 'K2H7A8', 'phone': '123-123-1234', 'name': '', 'province_code': 'ON', 'country_code': 'CA', 'country_name': 'Canada', 'default': True}}}



@app.route('/test', methods=['POST'])
def test():
    return json.dumps(t)


@app.route('/webhook', methods=['POST'])
def handle_webhook():
    data = request.get_json()
    print(data)
    # return "Hello"


if __name__ == '__main__':
    app.run(debug=True,  port=8080)
